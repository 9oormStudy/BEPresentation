# 제어의 역전 IoC, 의존관계 주입 DI

스프링 프레임워크
- 핵심기술: 스프링 DI 컨테이너, AOP, 이벤트, 기타
- 웹 기술: 스프링 MVC, 스프링 WebFlux
- 데이터 접근 기술: 트랜잭션, JDBC, ORM 지원, XML 지원
- 기술 통합: 캐시, 이메일, 원격접근, 스케줄링
- 테스트: 스프링 기반 테스트 지원
- 언어: 코틀린, 그루비

**스프링은 좋은 객체 지향 애플리케이션을 개발할 수 있게 도와주는 프레임워크이다.** 이번에는 스프링의 가장 기본이 되는 기술이자 스프링의 핵심 개발 원칙인 **IoC, DI** 에 대해 알아보겠다. 


## **IoC** (inversion of control) **제어의 역전이란?**

다음을 보면 B 객체를 사용하기 위해 클래스 A에서 객체를 **직접** 생성한 의존관계를 나타낸다. 즉, 개발자가 직접 객체를 제어하여 A객체가 B객체에 의존하고 있다.

```
public class A {
	b = new B();
}
```

제어의 역전은 다른 객체를 직접 생성하거나 제어하는 것이 아니라 **외부에서 관리하는 객체를 가져와 사용하는 것이다.** 방금 본 위 예제에 **제어의 역전**을 적용하면 다음과 같은 코드의 형태로 바뀐다.

```
public class A {
	private B b;
}
```

이전과는 다르게 클래스 B 객체를 직접 생성하는 것이 아니므로, 어딘가에서 **받아와서** 사용하고 있다고 추측해 볼 수 있다. 이처럼 제어의 역전을 적용하면 객체를 외부에서 관리하게 되고, 실제로 사용할 때에는 외부에서 제공해주는 객체를 받아오게 된다.


### IoC를 Spring에서 왜 사용하는가?

IoC는 Spring에서만 사용되는 개념이 아니다. 프로그래밍 패턴이기 때문에 범용적으로 쓰이며 컨테이너, 프레임워크 역할에 적합한 구조이기 때문에 상황에 맞게 사용되는 프로그래밍 모델이다. Spring은 Framework이다. 그렇기 때문에 흐름을 직접 핸들링 해줘야 하고, 자연스럽게 적합한 모델과 패턴을 적용해야 했기 때문에 Framework에 적합한 IoC, DI 개념 모델이 들어가게 된 것이다.


### Spring에서 IoC를 사용할 때 이점은 무엇인가?

이는 객체지향 프로그래밍과 관련이 깊다. 객체지향 프로그래밍은 **각 객체마다 자기의 역할과 책임을 다하고 서로 협력하며 변경에 유연**한 프로그래밍을 할 수 있는 프로그래밍 기법이다. 즉, 각 객체마다 올바른 캡슐화를 통해 높은 응집도와 낮은 결합도를 이루어나가는 것이 핵심이다. 이 관점에서 볼 때, 제어의 역전은 외부에 제어와 책임을 위임하고, 나머지 부분에 대해서는 다른 일에 집중하여 각자의 역할을 충실히 수행하는 것으로 이해된다. 이는 **유연한 코드 구조를 유지하기 위한 것**이다. 객체는 생성과 소멸을 포함한 기능이 언제든지 변경될 수 있기 때문에, 이러한 접근 방식은 변경에 대해 유연한 대응이 가능하다. 그래서 **많은 객체들을 편리하고 효율적으로 관리**할 수 있다는 장점이 있다.


## DI (Dependency Injection) 의존관계 주입이란?

DI는 IoC 프로그래밍 모델을 구현하는 방식 중 하나이다. Spring에서는 IoC를 구체적으로 DI라는 방식을 통해서 의존성 역전 제어를 하고 있다.

그럼 의존성 주입이란 무엇인가? ****외부에서 생성된 객체의 레퍼런스를 전달(주입)한다는 의미를 가진다. 다음을 보면 B b;라고 선언했을 뿐 직접 객체를 생성하지는 않고 있다. 다시 말해 **객체를 주입받고** 있다. (여기에서 사용하는 @Autowired 어노테이션은 스프링 컨테이너에 있는 빈이라는 것을 주입하는 역할을 한다. 빈은 쉽게 말해 **스프링 컨테이너에서 관리하는 객체**를 말한다.)


```
pulic class A {
	// A에서 B를 주입받음
	@Autowired
	B b;
}
```

이처럼 DI는 객체를 직접 생성하는게 아닌 **외부**(ex. IoC 컨테이너, DI 컨테이너)에서 생성한 후 **주입**시키는 방식으로 해석된다.


### DI (의존관계 주입)에 3가지 조건

- 클래스 모델이나 코드에는 런타임 시점의 의존관계가 드러나지 않는다. 그러기 위해서는 **인터페이스에만 의존**하고 있어야 한다.
- 런타임 시점의 **의존관계는 제3의 존재(ex. 컨테이너)가 결정**한다.
- 의존관계는 사용할 객체에 대한 레퍼런스를 **외부에서 주입**함으로써 만들어진다.

외부로부터 인터페이스 타입으로 얼마든지 부품이 교체 될 수 있으니 코드가 유연해진다. 이러한 DI를 잘 녹인 프레임워크가 스프링이다. 

**결론적으로 DI는 클래스타입이 고정되어 있지 않고 인터페이스 타입의 파라미터를 통해 다이나믹하게 구현 클래스를 결정해서 제공 받을 수 있어야 한다. 이것이 DI 핵심 개념이다.**

## **IoC와 DI는 무엇이 다른건가?**

IoC는 객체의 흐름, 생명주기관리 등 독립적인 제 3자에게 역할과 책임을 위임하는 방식에 프로그래밍 모델이다. 범용적인 표현인 것이다. 
DI는 인터페이스를 통해 다이나믹하게 객체를 주입을 하여 유연한 프로그래밍을 가능하게 하는 패턴으로 좀 더 구체적인 의미인 것이다.

## 출처
김영한 Inflearn '스프링 핵심 원리 - 기본편'
[https://biggwang.github.io/2019/08/31/Spring/IoC, DI란 무엇일까/](https://biggwang.github.io/2019/08/31/Spring/IoC,%20DI%EB%9E%80%20%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C/)
https://shinsunyoung.tistory.com/133
